# CSV Importer

A RESTful API generated by [generator-rest](https://github.com/diegohaz/generator-rest).

# Detailed Demo (hosted by Heroku)

First of all, there is no front end portion yet. You can use Postman or some other http message building tool to interact with the api. Please use https://csv-importer-aaron.herokuapp.com instead of {{app}} for the following examples.

## Get List of Albums Sorted By Year
``` javascript
var http = require("https");

var options = {
  "method": "GET",
  "hostname": "csv-importer-aaron.herokuapp.com",
  "path": "/albums?sort=-year",
};

var req = http.request(options, function (res) {
  var chunks = [];

  res.on("data", function (chunk) {
    chunks.push(chunk);
  });

  res.on("end", function () {
    var body = Buffer.concat(chunks);
    console.log(body.toString());
  });
});

req.end();
```

You can also just run a GET request in the browser pointed to `{{app}}/albums`

## Submit CSV File with Album Data
``` javascript
var http = require("https");

var options = {
  "method": "POST",
  "hostname": "csv-importer-aaron.herokuapp.com",
  "path": "/albums",
  "headers": {
    "content-type": "multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW"
  }
};

var req = http.request(options, function (res) {
  var chunks = [];

  res.on("data", function (chunk) {
    chunks.push(chunk);
  });

  res.on("end", function () {
    var body = Buffer.concat(chunks);
    console.log(body.toString());
  });
});

req.write("------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"file\"\r\n\r\n\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--");
req.end();
```

## CSV File Structure

```
name,year,artist
"Senger, Williamson and Deckow",2017,Mary Ruiz
Watsica LLC,1999,Joyce Lewis
Denesik-Vandervort,1984,Timothy Hicks
```

# Notes

This project uses a few libraries as a scaffolding of the rest application.

* querymen - A schema driven query translation middleware for transforming query strings to Mongo queries.
* bodymen - This is used lightly for deletes and updates for taking a json payload and applying schema to it. It will also perform some validation.
* express-fileupload - This allows for a file to be registered in the `req` portion of the pipeline.
* csvtojson - This small library allows for the parsing of the file as a string into json objects.

# To Do's

* Make single page application cosume api
* Allow for content type negotiation allowing for both JSON posts and CSV file uploads
* Add authentication & authorization (Basic or JWT)
* Add CSV file validation
* Read csv file from filesystem and not from memory (huge files will cause an issue)
